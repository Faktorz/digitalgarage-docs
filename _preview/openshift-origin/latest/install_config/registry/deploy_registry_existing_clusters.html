<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>OpenShift Origin | Installation and Configuration | Setting up the Registry | Deploying a Registry on Existing Clusters</title>
  <link href="/_stylesheets/subdomain.css" rel="stylesheet" type="text/css">
  <link href="/_stylesheets/docs.css" rel="stylesheet" type="text/css"/>
  <link href="/_stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css"/>
  <!--
  <link href="https://raw.githubusercontent.com/thedigitalgarage/origin-web-console/master/extensions/thedigitalgarage/css/main.css" rel="stylesheet" type="text/css">
  -->
  <link href="/_images/favicon.png" rel="apple-touch-icon-precomposed" type="image/png">
  <link href="/_images/favicon.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="the Digital Garage" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://assets.openshift.net/content/html5shiv.js" type="text/javascript"></script>
    <script src="https://assets.openshift.net/content/respond.js" type="text/javascript"></script>
    <link href="https://assets.openshift.net/content/vendor/respond-js/respond-proxy.html" id="respond-proxy" rel="respond-proxy">
    <link href="/_images/respond.proxy.gif" id="respond-redirect" rel="respond-redirect">
    <script src="/_javascripts/respond.proxy.js" type="text/javascript"></script>
  <![endif]-->
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/app/assets/site/tracking.js" type="text/javascript"></script>
  <script async src="//www.google-analytics.com/analytics.js" type="text/javascript"></script>
<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-40375612-1', 'openshift.org');
  ga('set', 'forceSSL', true);
  ga('send', 'pageview');
</script>
</head>
<body>
  <div class="navbar navbar-default navbar-openshift" role="navigation">
  <div class="navbar-header">
    <a class="navbar-brand" href="/"></a>
  </div>
  <div class="navbar-collapse collapse">
  </div>
</div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../../index.html">Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../../welcome/index.html">OpenShift Origin Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../../install_config/index.html">Installation and Configuration</a>
      </li>
      <li class="hidden-xs active"><a href="../../install_config/registry/index.html">Setting up the Registry</a></li>
      <li class="hidden-xs active">
        Deploying a Registry on Existing Clusters
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <div class="row-fluid">
          
<script>
  (function() {
    var cx = '013769182564158614814:vdyz7waqya4';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>About
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../../welcome/index.html">Welcome</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>What's New?
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../../whats_new/index.html">Overview</a></li>
            <li><a class="" href="../../whats_new/applications.html">Applications</a></li>
            <li><a class="" href="../../whats_new/carts_vs_images.html">Cartridges vs Images</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Getting Started
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../../getting_started/index.html">Overview</a></li>
            <li><a class="" href="../../getting_started/developers_console.html">Web Console Walkthrough</a></li>
            <li><a class="" href="../../getting_started/developers_cli.html">Command-Line Walkthrough</a></li>
            <li><a class="" href="../../getting_started/administrators.html">Setting Up a Cluster</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../../architecture/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-1">
                <span id="sgSpan-3-1" class="fa fa-caret-right"></span>&nbsp;Infrastructure Components
              </a>
              <ul id="topicSubGroup-3-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../architecture/infrastructure_components/kubernetes_infrastructure.html">Kubernetes Infrastructure</a></li>

                  <li><a class="" href="../../architecture/infrastructure_components/image_registry.html">Image Registry</a></li>

                  <li><a class="" href="../../architecture/infrastructure_components/web_console.html">Web Console</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-2">
                <span id="sgSpan-3-2" class="fa fa-caret-right"></span>&nbsp;Core Concepts
              </a>
              <ul id="topicSubGroup-3-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../architecture/core_concepts/index.html">Overview</a></li>

                  <li><a class="" href="../../architecture/core_concepts/containers_and_images.html">Containers and Images</a></li>

                  <li><a class="" href="../../architecture/core_concepts/pods_and_services.html">Pods and Services</a></li>

                  <li><a class="" href="../../architecture/core_concepts/projects_and_users.html">Projects and Users</a></li>

                  <li><a class="" href="../../architecture/core_concepts/builds_and_image_streams.html">Builds and Image Streams</a></li>

                  <li><a class="" href="../../architecture/core_concepts/deployments.html">Deployments</a></li>

                  <li><a class="" href="../../architecture/core_concepts/routes.html">Routes</a></li>

                  <li><a class="" href="../../architecture/core_concepts/templates.html">Templates</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-3">
                <span id="sgSpan-3-3" class="fa fa-caret-right"></span>&nbsp;Additional Concepts
              </a>
              <ul id="topicSubGroup-3-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../architecture/additional_concepts/networking.html">Networking</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/sdn.html">OpenShift SDN</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/authentication.html">Authentication</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/authorization.html">Authorization</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/storage.html">Persistent Storage</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/remote_commands.html">Remote Commands</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/port_forwarding.html">Port Forwarding</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/throttling.html">Throttling</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/scm.html">Source Control Management</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/admission_controllers.html">Admission Controllers</a></li>

                  <li><a class="" href="../../architecture/additional_concepts/other_api_objects.html">Other API Objects</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-down"></span>Installation and Configuration
      </a>
      <ul id="topicGroup4" class="collapse in list-unstyled">
            <li><a class="" href="../../install_config/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-1">
                <span id="sgSpan-4-1" class="fa fa-caret-right"></span>&nbsp;Installing a Cluster
              </a>
              <ul id="topicSubGroup-4-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../install_config/install/planning.html">Planning</a></li>

                  <li><a class="" href="../../install_config/install/prerequisites.html">Prerequisites</a></li>

                  <li><a class="" href="../../install_config/install/host_preparation.html">Host Preparation</a></li>

                  <li><a class="" href="../../install_config/install/rpm_vs_containerized.html">Containerized Components</a></li>

                  <li><a class="" href="../../install_config/install/quick_install.html">Quick Installation</a></li>

                  <li><a class="" href="../../install_config/install/advanced_install.html">Advanced Installation</a></li>

                  <li><a class="" href="../../install_config/install/stand_alone_registry.html">Installing a Stand-alone Registry</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-2">
                <span id="sgSpan-4-2" class="fa fa-caret-down"></span>&nbsp;Setting up the Registry
              </a>
              <ul id="topicSubGroup-4-2" class="nav-tertiary list-unstyled collapse in">

                  <li><a class="" href="../../install_config/registry/index.html">Registry Overview</a></li>

                  <li><a class=" active" href="../../install_config/registry/deploy_registry_existing_clusters.html">Deploying a Registry on Existing Clusters</a></li>

                  <li><a class="" href="../../install_config/registry/accessing_registry.html">Accessing the Registry</a></li>

                  <li><a class="" href="../../install_config/registry/securing_and_exposing_registry.html">Securing and Exposing the Registry</a></li>

                  <li><a class="" href="../../install_config/registry/extended_registry_configuration.html">Extended Registry Configuration</a></li>

                  <li><a class="" href="../../install_config/registry/registry_known_issues.html">Known Issues</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-3">
                <span id="sgSpan-4-3" class="fa fa-caret-right"></span>&nbsp;Setting up a Router
              </a>
              <ul id="topicSubGroup-4-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../install_config/router/index.html">Router Overview</a></li>

                  <li><a class="" href="../../install_config/router/default_haproxy_router.html">Using the Default HAProxy Router</a></li>

                  <li><a class="" href="../../install_config/router/customized_haproxy_router.html">Deploying a Customized HAProxy Router</a></li>

                  <li><a class="" href="../../install_config/router/f5_router.html">Using the F5 Router Plug-in</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-4">
                <span id="sgSpan-4-4" class="fa fa-caret-right"></span>&nbsp;Upgrading a Cluster
              </a>
              <ul id="topicSubGroup-4-4" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../install_config/upgrading/index.html">Overview</a></li>

                  <li><a class="" href="../../install_config/upgrading/automated_upgrades.html">Automated In-place Upgrades</a></li>

                  <li><a class="" href="../../install_config/upgrading/manual_upgrades.html">Manual In-place Upgrades</a></li>

                  <li><a class="" href="../../install_config/upgrading/blue_green_deployments.html">Blue-Green Deployments</a></li>
              </ul>
            </li>
            <li><a class="" href="../../install_config/master_node_configuration.html">Master and Node Configuration</a></li>
            <li><a class="" href="../../install_config/adding_hosts_to_existing_cluster.html">Adding Hosts to an Existing Cluster</a></li>
            <li><a class="" href="../../install_config/imagestreams_templates.html">Loading the Default Image Streams and Templates</a></li>
            <li><a class="" href="../../install_config/certificate_customization.html">Configuring Custom Certificates</a></li>
            <li><a class="" href="../../install_config/redeploying_certificates.html">Redeploying Certificates</a></li>
            <li><a class="" href="../../install_config/configuring_authentication.html">Configuring Authentication and User Agent</a></li>
            <li><a class="" href="../../install_config/syncing_groups_with_ldap.html">Syncing Groups With LDAP</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-12">
                <span id="sgSpan-4-12" class="fa fa-caret-right"></span>&nbsp;Advanced LDAP Configuration
              </a>
              <ul id="topicSubGroup-4-12" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../install_config/advanced_ldap_configuration/index.html">Overview</a></li>

                  <li><a class="" href="../../install_config/advanced_ldap_configuration/sssd_for_ldap_failover.html">Setting up SSSD for LDAP Failover</a></li>

                  <li><a class="" href="../../install_config/advanced_ldap_configuration/configuring_form_based_authentication.html">Configuring Form-Based Authentication</a></li>

                  <li><a class="" href="../../install_config/advanced_ldap_configuration/configuring_extended_ldap_attributes.html">Configuring Extended LDAP Attributes</a></li>
              </ul>
            </li>
            <li><a class="" href="../../install_config/configuring_sdn.html">Configuring the SDN</a></li>
            <li><a class="" href="../../install_config/configuring_aws.html">Configuring for AWS</a></li>
            <li><a class="" href="../../install_config/configuring_openstack.html">Configuring for OpenStack</a></li>
            <li><a class="" href="../../install_config/configuring_gce.html">Configuring for GCE</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-17">
                <span id="sgSpan-4-17" class="fa fa-caret-right"></span>&nbsp;Configuring Persistent Storage
              </a>
              <ul id="topicSubGroup-4-17" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../install_config/persistent_storage/index.html">Overview</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_nfs.html">Using NFS</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_glusterfs.html">Using GlusterFS</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_cinder.html">Using OpenStack Cinder</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_ceph_rbd.html">Using Ceph RBD</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_aws.html">Using AWS Elastic Block Store</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_gce.html">Using GCE Persistent Disk</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_iscsi.html">Using iSCSI</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/persistent_storage_fibre_channel.html">Using Fibre Channel</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/dynamically_provisioning_pvs.html">Dynamic Provisioning</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/pod_security_context.html">Volume Security</a></li>

                  <li><a class="" href="../../install_config/persistent_storage/selector_label_binding.html">Selector-Label Volume Binding</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-4-18">
                <span id="sgSpan-4-18" class="fa fa-caret-right"></span>&nbsp;Persistent Storage Examples
              </a>
              <ul id="topicSubGroup-4-18" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../install_config/storage_examples/index.html">Overview</a></li>

                  <li><a class="" href="../../install_config/storage_examples/shared_storage.html">Sharing an NFS PV Across Two Pods</a></li>

                  <li><a class="" href="../../install_config/storage_examples/ceph_example.html">Complete Example Using Ceph RBD</a></li>

                  <li><a class="" href="../../install_config/storage_examples/gluster_example.html">Complete Example Using GlusterFS</a></li>

                  <li><a class="" href="../../install_config/storage_examples/privileged_pod_storage.html">Mounting Volumes To Privileged Pods</a></li>

                  <li><a class="" href="../../install_config/storage_examples/gluster_backed_registry.html">Backing Docker Registry with GlusterFS Storage</a></li>

                  <li><a class="" href="../../install_config/storage_examples/binding_pv_by_label.html">Binding Persistent Volumes by Label</a></li>
              </ul>
            </li>
            <li><a class="" href="../../install_config/http_proxies.html">Working with HTTP Proxies</a></li>
            <li><a class="" href="../../install_config/build_defaults_overrides.html">Configuring Global Build Defaults and Overrides</a></li>
            <li><a class="" href="../../install_config/configuring_pipeline_execution.html">Configuring Build Pipeline Execution</a></li>
            <li><a class="" href="../../install_config/configuring_routing.html">Configuring Routing</a></li>
            <li><a class="" href="../../install_config/routing_from_edge_lb.html">Routing from Edge Load Balancers</a></li>
            <li><a class="" href="../../install_config/aggregate_logging.html">Aggregating Container Logs</a></li>
            <li><a class="" href="../../install_config/aggregate_logging_sizing.html">Aggregate Logging Sizing Guidelines</a></li>
            <li><a class="" href="../../install_config/cluster_metrics.html">Enabling Cluster Metrics</a></li>
            <li><a class="" href="../../install_config/web_console_customization.html">Customizing the Web Console</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>Cluster Administration
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../../admin_guide/index.html">Overview</a></li>
            <li><a class="" href="../../admin_guide/manage_nodes.html">Managing Nodes</a></li>
            <li><a class="" href="../../admin_guide/manage_users.html">Managing Users</a></li>
            <li><a class="" href="../../admin_guide/managing_projects.html">Managing Projects</a></li>
            <li><a class="" href="../../admin_guide/managing_pods.html">Managing Pods</a></li>
            <li><a class="" href="../../admin_guide/service_accounts.html">Configuring Service Accounts</a></li>
            <li><a class="" href="../../admin_guide/manage_authorization_policy.html">Managing Authorization Policies</a></li>
            <li><a class="" href="../../admin_guide/image_policy.html">Image Policy</a></li>
            <li><a class="" href="../../admin_guide/monitoring_images.html">Monitoring Images</a></li>
            <li><a class="" href="../../admin_guide/manage_scc.html">Managing Security Context Constraints</a></li>
            <li><a class="" href="../../admin_guide/quota.html">Setting Quotas</a></li>
            <li><a class="" href="../../admin_guide/multiproject_quota.html">Setting Multi-Project Quotas</a></li>
            <li><a class="" href="../../admin_guide/limits.html">Setting Limit Ranges</a></li>
            <li><a class="" href="../../admin_guide/pruning_resources.html">Pruning Objects</a></li>
            <li><a class="" href="../../admin_guide/garbage_collection.html">Garbage Collection</a></li>
            <li><a class="" href="../../admin_guide/scheduler.html">Scheduler</a></li>
            <li><a class="" href="../../admin_guide/allocating_node_resources.html">Allocating Node Resources</a></li>
            <li><a class="" href="../../admin_guide/overcommit.html">Overcommitting</a></li>
            <li><a class="" href="../../admin_guide/tcp_ingress_external_ports.html">Assigning Unique External IPs for Ingress Traffic</a></li>
            <li><a class="" href="../../admin_guide/router.html">Monitoring Routers</a></li>
            <li><a class="" href="../../admin_guide/high_availability.html">High Availability</a></li>
            <li><a class="" href="../../admin_guide/iptables.html">IPtables</a></li>
            <li><a class="" href="../../admin_guide/securing_builds.html">Securing Builds by Strategy</a></li>
            <li><a class="" href="../../admin_guide/building_dependency_trees.html">Building Dependency Trees</a></li>
            <li><a class="" href="../../admin_guide/backup_restore.html">Backup and Restore</a></li>
            <li><a class="" href="../../admin_guide/sdn_troubleshooting.html">Troubleshooting Networking</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>CLI Reference
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../../cli_reference/index.html">Overview</a></li>
            <li><a class="" href="../../cli_reference/get_started_cli.html">Get Started with the CLI</a></li>
            <li><a class="" href="../../cli_reference/manage_cli_profiles.html">Managing CLI Profiles</a></li>
            <li><a class="" href="../../cli_reference/basic_cli_operations.html">Developer CLI Operations</a></li>
            <li><a class="" href="../../cli_reference/admin_cli_operations.html">Administrator CLI Operations</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7">
        <span id="tgSpan7" class="fa fa-angle-right"></span>Developer Guide
      </a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../../dev_guide/index.html">Overview</a></li>
            <li><a class="" href="../../dev_guide/application_lifecycle.html">Application Life Cycle Examples</a></li>
            <li><a class="" href="../../dev_guide/authentication.html">Authentication</a></li>
            <li><a class="" href="../../dev_guide/projects.html">Projects</a></li>
            <li><a class="" href="../../dev_guide/new_app.html">Creating New Applications</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-7-5">
                <span id="sgSpan-7-5" class="fa fa-caret-right"></span>&nbsp;Migrating Applications
              </a>
              <ul id="topicSubGroup-7-5" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../dev_guide/migrating_applications/index.html">Overview</a></li>

                  <li><a class="" href="../../dev_guide/migrating_applications/database_applications.html">Database Applications</a></li>

                  <li><a class="" href="../../dev_guide/migrating_applications/web_framework_applications.html">Web Framework Applications</a></li>

                  <li><a class="" href="../../dev_guide/migrating_applications/quickstart_examples.html">QuickStart Examples</a></li>

                  <li><a class="" href="../../dev_guide/migrating_applications/continuous_integration_and_deployment.html">Continuous Integration and Deployment</a></li>

                  <li><a class="" href="../../dev_guide/migrating_applications/web_hooks_action_hooks.html">Webhooks and Action Hooks</a></li>

                  <li><a class="" href="../../dev_guide/migrating_applications/S2I_tool.html">S2I Tool</a></li>

                  <li><a class="" href="../../dev_guide/migrating_applications/support_guide.html">Support Guide</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-7-6">
                <span id="sgSpan-7-6" class="fa fa-caret-right"></span>&nbsp;Application Tutorials
              </a>
              <ul id="topicSubGroup-7-6" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../dev_guide/app_tutorials/index.html">Overview</a></li>

                  <li><a class="" href="../../dev_guide/app_tutorials/quickstarts.html">Quickstart Templates</a></li>

                  <li><a class="" href="../../dev_guide/app_tutorials/ruby_on_rails.html">Ruby on Rails</a></li>

                  <li><a class="" href="../../dev_guide/app_tutorials/maven_tutorial.html">Setting Up a Nexus Mirror</a></li>
              </ul>
            </li>
            <li><a class="" href="../../dev_guide/ssh_environment.html">Opening a Remote Shell to Containers</a></li>
            <li><a class="" href="../../dev_guide/templates.html">Templates</a></li>
            <li><a class="" href="../../dev_guide/service_accounts.html">Service Accounts</a></li>
            <li><a class="" href="../../dev_guide/builds.html">Builds</a></li>
            <li><a class="" href="../../dev_guide/managing_images.html">Managing Images</a></li>
            <li><a class="" href="../../dev_guide/compute_resources.html">Quotas and Limit Ranges</a></li>
            <li><a class="" href="../../dev_guide/deployments.html">Deployments</a></li>
            <li><a class="" href="../../dev_guide/getting_traffic_into_cluster.html">Getting Traffic Into The Cluster</a></li>
            <li><a class="" href="../../dev_guide/routes.html">Routes</a></li>
            <li><a class="" href="../../dev_guide/integrating_external_services.html">Integrating External Services</a></li>
            <li><a class="" href="../../dev_guide/secrets.html">Secrets</a></li>
            <li><a class="" href="../../dev_guide/configmaps.html">ConfigMaps</a></li>
            <li><a class="" href="../../dev_guide/daemonsets.html">Using Daemonsets</a></li>
            <li><a class="" href="../../dev_guide/pod_autoscaling.html">Pod Autoscaling</a></li>
            <li><a class="" href="../../dev_guide/volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../../dev_guide/persistent_volumes.html">Using Persistent Volumes</a></li>
            <li><a class="" href="../../dev_guide/executing_remote_commands.html">Executing Remote Commands</a></li>
            <li><a class="" href="../../dev_guide/copy_files_to_container.html">Copying Files</a></li>
            <li><a class="" href="../../dev_guide/port_forwarding.html">Port Forwarding</a></li>
            <li><a class="" href="../../dev_guide/shared_memory.html">Shared Memory</a></li>
            <li><a class="" href="../../dev_guide/application_health.html">Application Health</a></li>
            <li><a class="" href="../../dev_guide/events.html">Events</a></li>
            <li><a class="" href="../../dev_guide/downward_api.html">Downward API</a></li>
            <li><a class="" href="../../dev_guide/environment_variables.html">Managing Environment Variables</a></li>
            <li><a class="" href="../../dev_guide/jobs.html">Jobs</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8">
        <span id="tgSpan8" class="fa fa-angle-right"></span>Creating Images
      </a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li><a class="" href="../../creating_images/index.html">Overview</a></li>
            <li><a class="" href="../../creating_images/guidelines.html">Guidelines</a></li>
            <li><a class="" href="../../creating_images/metadata.html">Image Metadata</a></li>
            <li><a class="" href="../../creating_images/s2i.html">S2I Requirements</a></li>
            <li><a class="" href="../../creating_images/s2i_testing.html">Testing S2I Images</a></li>
            <li><a class="" href="../../creating_images/custom.html">Custom Builder</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup9">
        <span id="tgSpan9" class="fa fa-angle-right"></span>Using Images
      </a>
      <ul id="topicGroup9" class="collapse  list-unstyled">
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-9-0">
                <span id="sgSpan-9-0" class="fa fa-caret-right"></span>&nbsp;Source-to-Image (S2I)
              </a>
              <ul id="topicSubGroup-9-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../using_images/s2i_images/index.html">Overview</a></li>

                  <li><a class="" href="../../using_images/s2i_images/customizing_s2i_images.html">Customizing S2I images</a></li>

                  <li><a class="" href="../../using_images/s2i_images/nodejs.html">Node.js</a></li>

                  <li><a class="" href="../../using_images/s2i_images/ruby.html">Ruby</a></li>

                  <li><a class="" href="../../using_images/s2i_images/perl.html">Perl</a></li>

                  <li><a class="" href="../../using_images/s2i_images/php.html">PHP</a></li>

                  <li><a class="" href="../../using_images/s2i_images/python.html">Python</a></li>

                  <li><a class="" href="../../using_images/s2i_images/java.html">Java</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-9-1">
                <span id="sgSpan-9-1" class="fa fa-caret-right"></span>&nbsp;Database Images
              </a>
              <ul id="topicSubGroup-9-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../using_images/db_images/index.html">Overview</a></li>

                  <li><a class="" href="../../using_images/db_images/mysql.html">MySQL</a></li>

                  <li><a class="" href="../../using_images/db_images/postgresql.html">PostgreSQL</a></li>

                  <li><a class="" href="../../using_images/db_images/mongodb.html">MongoDB</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-9-2">
                <span id="sgSpan-9-2" class="fa fa-caret-right"></span>&nbsp;Docker Images
              </a>
              <ul id="topicSubGroup-9-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../using_images/docker_images/index.html">Overview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-9-3">
                <span id="sgSpan-9-3" class="fa fa-caret-right"></span>&nbsp;Other Images
              </a>
              <ul id="topicSubGroup-9-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../../using_images/other_images/index.html">Overview</a></li>

                  <li><a class="" href="../../using_images/other_images/jenkins.html">Jenkins</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup10">
        <span id="tgSpan10" class="fa fa-angle-right"></span>REST API Reference
      </a>
      <ul id="topicGroup10" class="collapse  list-unstyled">
            <li><a class="" href="../../rest_api/index.html">Overview</a></li>
            <li><a class="" href="../../rest_api/openshift_v1.html">OpenShift v1</a></li>
            <li><a class="" href="../../rest_api/kubernetes_v1.html">Kubernetes v1</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Deploying a Registry on Existing Clusters</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#deploy-registry">Deploying the Registry</a></li>
<li><a href="#deploying-the-registry-as-a-daemonset">Deploying the Registry as a DaemonSet</a></li>
<li><a href="#registry-compute-resource">Registry Compute Resources</a></li>
<li><a href="#storage-for-the-registry">Storage for the Registry</a>
<ul class="sectlevel2">
<li><a href="#registry-production-use">Production Use</a></li>
<li><a href="#registry-non-production-use">Non-Production Use</a></li>
</ul>
</li>
<li><a href="#registry-console">Enabling the Registry Console</a>
<ul class="sectlevel2">
<li><a href="#deploying-the-registry-console">Deploying the Registry Console</a></li>
<li><a href="#securing-the-registry-console">Securing the Registry Console</a></li>
<li><a href="#registry-console-troubleshooting">Troubleshooting the Registry Console</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the integrated registry was not previously deployed automatically during the
initial installation of your OpenShift Origin cluster, or if it is no longer
running successfully and you need to redeploy it on your existing cluster, see
the following sections for options on deploying a new registry.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This topic is not required if you installed a
<a href="../../install_config/install/stand_alone_registry.html#install-config-installing-stand-alone-registry">stand-alone registry</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-registry"><a class="anchor" href="#deploy-registry"></a>Deploying the Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To deploy the integrated Docker registry, use the <code>oadm registry</code> command from
the <strong><em>admin.kubeconfig</em></strong> file&#8217;s location, as a user with cluster administrator
privileges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm registry --config=admin.kubeconfig \<i class="conum" data-value="1"></i><b>(1)</b>
    --service-account=registry <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>--config</code> is the path to the
<a href="../../cli_reference/manage_cli_profiles.html#cli-reference-manage-cli-profiles">CLI configuration file</a> for
the <a href="../../architecture/additional_concepts/authorization.html#roles">cluster
administrator</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>--service-account</code> is the service account used to run the registry&#8217;s pod.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This creates a service and a deployment configuration, both called
<strong>docker-registry</strong>. Once deployed successfully, a pod is created with a name
similar to <strong>docker-registry-1-cpty9</strong>.</p>
</div>
<div class="paragraph">
<p>To see a full list of options that you can specify when creating the registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm registry --help</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploying-the-registry-as-a-daemonset"><a class="anchor" href="#deploying-the-registry-as-a-daemonset"></a>Deploying the Registry as a DaemonSet</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the <code>oadm registry</code> command to deploy the registry as a DaemonSet with the
<code>--daemonset</code> option.</p>
</div>
<div class="paragraph">
<p>Daemonsets ensure that when nodes are created, they contain copies of a
specified pod. When the nodes are removed, the pods are garbage collected.</p>
</div>
<div class="paragraph">
<p>For more information on DaemonSets, see the
<a href="http://kubernetes.io/docs/admin/daemons/">DaemonSet documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using DaemonSets with OpenShift Origin is a work in progress, and the only
supported process is creating a registry. Currently, using deployment
configurations to deploy a registry is recommended.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-compute-resource"><a class="anchor" href="#registry-compute-resource"></a>Registry Compute Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the registry is created with no settings for
<a href="../../dev_guide/compute_resources.html#dev-guide-compute-resources">compute resource requests or
limits</a>. For production, it is highly recommended that the deployment
configuration for the registry be updated to set resource requests and limits
for the registry pod. Otherwise, the registry pod will be considered a
<a href="../../dev_guide/compute_resources.html#quality-of-service-tiers"><strong>BestEffort</strong>
pod</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="../../dev_guide/compute_resources.html#dev-guide-compute-resources">Compute Resources</a> for more
information on configuring requests and limits.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="storage-for-the-registry"><a class="anchor" href="#storage-for-the-registry"></a>Storage for the Registry</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The registry stores Docker images and metadata. If you simply deploy a pod with
the registry, it uses an ephemeral volume that is destroyed if the pod exits.
Any images anyone has built or pushed into the registry would disappear.</p>
</div>
<div class="sect2">
<h3 id="registry-production-use"><a class="anchor" href="#registry-production-use"></a>Production Use</h3>
<div class="paragraph">
<p>For production use, attach a remote volume or
<a href="../../install_config/persistent_storage/index.html#install-config-persistent-storage-index">define and use the
persistent storage method of your choice</a>.</p>
</div>
<div class="paragraph">
<p>For example, to use an existing persistent volume claim:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc volume deploymentconfigs/docker-registry --add --name=registry-storage -t pvc \
     --claim-name=&lt;pvc_name&gt; --overwrite</pre>
</div>
</div>
<div class="paragraph">
<p>Or, to attach an existing NFS volume to the registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc volume deploymentconfigs/docker-registry \
     --add --overwrite --name=registry-storage --mount-path=/registry \
     --source='{"nfs": { "server": "&lt;fqdn&gt;", "path": "/path/to/export"}}'</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See <a href="registry_known_issues.html#install-config-registry-known-issues">Known Issues</a> if using a scaled registry with a
shared NFS volume.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="registry-amazon-s3-storage-back-end"><a class="anchor" href="#registry-amazon-s3-storage-back-end"></a>Use Amazon S3 as a Storage Back-end</h4>
<div class="paragraph">
<p>There is also an option to use Amazon Simple Storage Service storage with the
internal Docker registry. It is a secure cloud storage manageable through
<a href="https://aws.amazon.com/s3/getting-started/">AWS Management Console</a>. To use
it, the registry&#8217;s configuration file must be manually edited and mounted to
the registry pod. However, before you start with the configuration, look at
upstream&#8217;s
<a href="https://docs.docker.com/docker-trusted-registry/configure/config-storage/#amazon-s3">recommended
steps</a>.</p>
</div>
<div class="paragraph">
<p>Take a <a href="extended_registry_configuration.html#advanced-overriding-the-registry-configuration">default YAML configuration file</a> as a base and replace the <strong>filesystem</strong> entry in the
<strong>storage</strong> section with <strong>s3</strong> entry such as below. The resulting storage section
may look like this:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml"><span style="color:#606">storage</span>:
  <span style="color:#606">cache</span>:
    <span style="color:#606">layerinfo</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">inmemory</span></span>
  <span style="color:#606">delete</span>:
    <span style="color:#606">enabled</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
  <span style="color:#606">s3</span>:
    <span style="color:#606">accesskey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">awsaccesskey</span></span>
    <span style="color:#606">secretkey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">awssecretkey</span></span>
    <span style="color:#606">region</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">us-west-1</span></span>
    <span style="color:#606">regionendpoint</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">http://myobjects.local</span></span>
    <span style="color:#606">bucket</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">bucketname</span></span>
    <span style="color:#606">encrypt</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
    <span style="color:#606">keyid</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mykeyid</span></span>
    <span style="color:#606">secure</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
    <span style="color:#606">v4auth</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">false</span></span>
    <span style="color:#606">chunksize</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">5242880</span></span>
    <span style="color:#606">rootdirectory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">/s3/object/name/prefix</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All of the <strong>s3</strong> configuration options are documented in upstream&#8217;s
<a href="https://docs.docker.com/registry/storage-drivers/s3/">driver reference
documentation</a>.</p>
</div>
<div class="paragraph">
<p><a href="extended_registry_configuration.html#advanced-overriding-the-registry-configuration">Overriding the registry configuration</a> will take you through the additional steps on mounting the
configuration file into pod.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the registry runs on the S3 storage back-end, there are
<a href="registry_known_issues.html#known-issue-s3-image-push-fails">reported issues</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registry-non-production-use"><a class="anchor" href="#registry-non-production-use"></a>Non-Production Use</h3>
<div class="paragraph">
<p>For non-production use, you can use the <code>--mount-host=&lt;path&gt;</code> option to specify
a directory for the registry to use for persistent storage. The registry volume
is then created as a host-mount at the specified <code>&lt;path&gt;</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>--mount-host</code> option mounts a directory from the node on which the registry
container lives. If you scale up the <strong>docker-registry</strong> deployment configuration,
it is possible that your registry pods and containers will run on different
nodes, which can result in two or more registry containers, each with its own
local storage. This will lead to unpredictable behavior, as subsequent requests
to pull the same image repeatedly may not always succeed, depending on which
container the request ultimately goes to.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>--mount-host</code> option requires that the registry container run in privileged
mode. This is automatically enabled when you specify <code>--mount-host</code>.
However, not all pods are allowed to run
<a href="../install/prerequisites.html#security-warning">privileged containers</a> by default.
If you still want to use this option:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new <a href="../../admin_guide/service_accounts.html#admin-guide-service-accounts">service account</a> in
the <strong>default</strong> project for the registry to run as. The following example creates
a service account named <strong>registry</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create serviceaccount registry -n default</pre>
</div>
</div>
</li>
<li>
<p>To add the new <strong>registry</strong> service account in the <strong>default</strong> namespace
to the list of users allowed to run privileged containers:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm policy add-scc-to-user privileged system:serviceaccount:default:registry</pre>
</div>
</div>
</li>
<li>
<p>Create the registry and specify that it use the new <strong>registry</strong> service
account:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oadm registry --service-account=registry \
    --config=admin.kubeconfig \
    --mount-host=&lt;path&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Docker registry pod runs as user <strong>1001</strong>. This user must be able to write to
the host directory. You may need to change directory ownership to user ID <strong>1001</strong>
with this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ sudo chown 1001:root &lt;path&gt;</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="registry-console"><a class="anchor" href="#registry-console"></a>Enabling the Registry Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift Origin provides a web-based interface to the integrated registry. This
registry console is an optional component for browsing and managing images. It
is deployed as a stateless service running as a pod.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you installed OpenShift Origin as a
<a href="../../install_config/install/stand_alone_registry.html#install-config-installing-stand-alone-registry">stand-alone registry</a>, the registry console is already deployed and secured automatically
during installation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="deploying-the-registry-console"><a class="anchor" href="#deploying-the-registry-console"></a>Deploying the Registry Console</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must first have <a href="../../install_config/registry/securing_and_exposing_registry.html#exposing-the-registry">exposed the registry</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install template in the default namespace</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">oc create -n default -f https://raw.githubusercontent.com/openshift/openshift-ansible/master/roles/openshift_examples/files/examples/v1.3/infrastructure-templates/origin/registry-console.yaml</pre>
</div>
</div>
</li>
<li>
<p>Create a passthrough route in the <strong>default</strong> project. You will need this when
creating the registry console application in the next step.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc create route passthrough --service registry-console \
    --port registry-console \
    -n default</pre>
</div>
</div>
</li>
<li>
<p>Deploy the registry console application. Replace <code>&lt;openshift_oauth_url&gt;</code> with
the URL of the OpenShift Origin OAuth provider, which is typically the master.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc new-app -n default --template=registry-console -p \
           OPENSHIFT_OAUTH_PROVIDER_URL="https://&lt;openshift_oauth_url&gt;:8443",REGISTRY_HOST=$(oc get route docker-registry -n default --template='{{ .spec.host }}'),COCKPIT_KUBE_URL=$(oc get route registry-console -n default --template='https://{{ .spec.host }}')</pre>
</div>
</div>
</li>
<li>
<p>Finally, use a web browser to view the console using the route URI.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="securing-the-registry-console"><a class="anchor" href="#securing-the-registry-console"></a>Securing the Registry Console</h3>
<div class="paragraph">
<p>By default, the registry console generates self-signed TLS certificates if
deployed manually per the steps in <a href="#deploying-the-registry-console">Deploying
the Registry Console</a>. See <a href="#registry-console-troubleshooting">Troubleshooting the
Registry Console</a> for more information.</p>
</div>
<div class="paragraph">
<p>Use the following steps to add your organization&#8217;s signed certificates as a
secret volume. This assumes your certificates are available on the the <code>oc</code>
client host.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the secret:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc secrets new console-secret \
    /path/to/console.crt \
    /path/to/console.key</pre>
</div>
</div>
</li>
<li>
<p>Add the secrets to the <strong>registry-console</strong> deployment configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc volume dc/registry-console --add --type=secret \
    --secret-name=console-secret -m /etc/cockpit/ws-certs.d</pre>
</div>
</div>
<div class="paragraph">
<p>This triggers a new deployment of the registry console to include your signed
certificates.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="registry-console-troubleshooting"><a class="anchor" href="#registry-console-troubleshooting"></a>Troubleshooting the Registry Console</h3>
<div class="sect3">
<h4 id="registry-console-debug-mode"><a class="anchor" href="#registry-console-debug-mode"></a>Debug Mode</h4>
<div class="paragraph">
<p>The registry console debug mode is enabled using an environment variable. The
following command redeploys the registry console in debug mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc env dc registry-console G_MESSAGES_DEBUG=cockpit-ws,cockpit-wrapper</pre>
</div>
</div>
<div class="paragraph">
<p>Enabling debug mode allows more verbose logging to appear in the registry
console&#8217;s pod logs.</p>
</div>
</div>
<div class="sect3">
<h4 id="registry-console-certificate-format"><a class="anchor" href="#registry-console-certificate-format"></a>Certificate Format</h4>
<div class="paragraph">
<p>The registry console loads a certificate from the <strong><em>/etc/cockpit/ws-certs.d</em></strong>
directory. It uses the last file with a <strong><em>.cert</em></strong> extension in alphabetical
order. The <strong><em>.cert</em></strong> file should contain at least two OpenSSL style PEM blocks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, one or more <strong>BEGIN CERTIFICATE</strong> blocks for the server certificate and the
intermediate certificate authorities</p>
</li>
<li>
<p>Lastly, a block containing a <strong>BEGIN PRIVATE KEY</strong> or similar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The key may not be encrypted. For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">-----BEGIN CERTIFICATE-----
MIIDUzCCAjugAwIBAgIJAPXW+CuNYS6QMA0GCSqGSIb3DQEBCwUAMD8xKTAnBgNV
BAoMIGI0OGE2NGNkNmMwNTQ1YThhZTgxOTEzZDE5YmJjMmRjMRIwEAYDVQQDDAls
...
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDUzCCAjugAwIBAgIJAPXW+CuNYS6QMA0GCSqGSIb3DQEBCwUAMD8xKTAnBgNV
BAoMIGI0OGE2NGNkNmMwNTQ1YThhZTgxOTEzZDE5YmJjMmRjMRIwEAYDVQQDDAls
...
-----END CERTIFICATE-----
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCyOJ5garOYw0sm
8TBCDSqQ/H1awGMzDYdB11xuHHsxYS2VepPMzMzryHR137I4dGFLhvdTvJUH8lUS
...
-----END PRIVATE KEY-----</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If no certificate is found, a self-signed certificate is created using the
<code>openssl</code> command and stored in the <strong><em>0-self-signed.cert</em></strong> file.</p>
</div>
</div>
<div class="sect3">
<h4 id="registry-console-display-ssl-cert-path"><a class="anchor" href="#registry-console-display-ssl-cert-path"></a>Display SSL Certificate Path</h4>
<div class="paragraph">
<p>To check which certificate the registry console is using, a command can be run
from inside the console pod.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List the pods in the <strong>default</strong> project and find the registry console&#8217;s pod name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc get pods -n default
NAME                       READY     STATUS    RESTARTS   AGE
registry-console-1-rssrw   1/1       Running   0          1d</pre>
</div>
</div>
</li>
<li>
<p>Using the pod name from the previous command, get the certificate path that the
<strong>cockpit-ws</strong> process is using. This example shows the console using the
auto-generated certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ oc exec registry-console-1-rssrw remotectl certificate
certificate: /etc/cockpit/ws-certs.d/0-self-signed.cert</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
    <footer class="footer-origin-docs">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <div id="footer_social">
          <a href="https://twitter.com/openshift" class="first">
            <span>
              <i class="fa fa-twitter-square fa-2x fa-inverse"></i>
            </span>
          </a>
          <a href="https://github.com/openshift/origin">
            <span>
              <i class="fa fa-github fa-2x fa-inverse"></i>
            </span>
          </a>
          <a href="https://plus.google.com/communities/114361859072744017486">
            <span>
              <i class="fa fa-google-plus-square fa-2x fa-inverse"></i>
            </span>
          </a>
          <a href="https://www.facebook.com/openshift">
            <span>
              <i class="fa fa-facebook-square fa-2x fa-inverse"></i>
            </span>
          </a>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12 col-sm-4">
        <a id="footer_logo" href="https://www.redhat.com/">
          <img alt="Red Hat" src="https://assets.openshift.net/app/assets/redhat.svg">
        </a>
      </div>
      <div class="col-xs-12 col-sm-4 text-center">
        <a id="powered_by_openshift" title="Powered by OpenShift Online with the DIY Cartridge" href="https://hub.openshift.com/quickstarts/92-do-it-yourself-0-1">
          <img src="https://www.openshift.com/sites/default/files/images/powered-transparent-white.png" alt="Powered by OpenShift Online">
        </a>
      </div>
      <div class="col-xs-12 col-sm-4 text-right">
        <a id="built_with_asciibinder" title="Built with AsciiBinder docs management system" href="http://asciibinder.org/">
          <img src="../../../latest/_images/asciibinder_web_logo.svg" alt="AsciiBinder">
        </a>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <div class="attribution">
          <button type="button" class="btn btn-link" data-html="true" data-container="body" data-toggle="popover" data-placement="top" data-content="
            '<a target='_blank' href='https://www.flickr.com/photos/eflon/3655695161/'>Spin</a>' by <a target='_blank' href='https://www.flickr.com/photos/eflon/'>eflon</a>,</br> used under <a target='_blank' href='https://creativecommons.org/licenses/by/2.0/'>CC BY 2.0</a> </br>Color tint added to original">
            Image attribution
          </button>
        </div>
      </div>
    </div>
    <script>
    $(function () {
      $('[data-toggle="popover"]').popover()
    })
    </script>
  </div>
</footer>
</body>
</html>