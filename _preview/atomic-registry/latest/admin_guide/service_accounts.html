<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Atomic Registry | Cluster Administration | Configuring Service Accounts</title>
  <link href="/_stylesheets/subdomain.css" rel="stylesheet" type="text/css">
  <link href="/_stylesheets/docs.css" rel="stylesheet" type="text/css"/>
  <link href="/_stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css"/>
  <!--
  <link href="https://raw.githubusercontent.com/thedigitalgarage/origin-web-console/master/extensions/thedigitalgarage/css/main.css" rel="stylesheet" type="text/css">
  -->
  <link href="/_images/favicon.png" rel="apple-touch-icon-precomposed" type="image/png">
  <link href="/_images/favicon.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="the Digital Garage" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://assets.openshift.net/content/html5shiv.js" type="text/javascript"></script>
    <script src="https://assets.openshift.net/content/respond.js" type="text/javascript"></script>
    <link href="https://assets.openshift.net/content/vendor/respond-js/respond-proxy.html" id="respond-proxy" rel="respond-proxy">
    <link href="/_images/respond.proxy.gif" id="respond-redirect" rel="respond-redirect">
    <script src="/_javascripts/respond.proxy.js" type="text/javascript"></script>
  <![endif]-->
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/app/assets/site/tracking.js" type="text/javascript"></script>
  <script type="text/javascript" src="https://assets.openshift.net/app/assets/site/tracking.js"></script>
</head>
<body>
  <div class="navbar navbar-default navbar-openshift" role="navigation">
  <div class="navbar-header">
    <a class="navbar-brand" href="/"></a>
  </div>
  <div class="navbar-collapse collapse">
  </div>
</div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Atomic Registry Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../registry_quickstart/index.html">Atomic Registry Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin_guide/index.html">Cluster Administration</a>
      </li>
      
      <li class="hidden-xs active">
        Configuring Service Accounts
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <div class="row-fluid">
          
<script>
  (function() {
    var cx = '013769182564158614814:e-dp46b51vk';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Quickstart
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../registry_quickstart/index.html">Overview</a></li>
            <li><a class="" href="../registry_quickstart/developers.html">Developers</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-2">
                <span id="sgSpan-0-2" class="fa fa-caret-right"></span>&nbsp;Administrators
              </a>
              <ul id="topicSubGroup-0-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../registry_quickstart/administrators/index.html">Overview</a></li>

                  <li><a class="" href="../registry_quickstart/administrators/system_configuration.html">System Configuration</a></li>

                  <li><a class="" href="../registry_quickstart/administrators/uninstall.html">Uninstall</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-1-0">
                <span id="sgSpan-1-0" class="fa fa-caret-right"></span>&nbsp;Core Concepts
              </a>
              <ul id="topicSubGroup-1-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../architecture/core_concepts/containers_and_images.html">Images</a></li>

                  <li><a class="" href="../architecture/core_concepts/projects_and_users.html">Projects and Users</a></li>

                  <li><a class="" href="../architecture/core_concepts/builds_and_image_streams.html">Image Streams</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Installation and Configuration
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../install_config/adding_hosts_to_existing_cluster.html">Adding Hosts to an Existing Cluster</a></li>
            <li><a class="" href="../install_config/certificate_customization.html">Configuring Custom Certificates</a></li>
            <li><a class="" href="../install_config/redeploying_certificates.html">Redeploying Certificates</a></li>
            <li><a class="" href="../install_config/configuring_authentication.html">Configuring Authentication and User Agent</a></li>
            <li><a class="" href="../install_config/syncing_groups_with_ldap.html">Syncing Groups With LDAP</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-5">
                <span id="sgSpan-2-5" class="fa fa-caret-right"></span>&nbsp;Advanced LDAP Configuration
              </a>
              <ul id="topicSubGroup-2-5" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../install_config/advanced_ldap_configuration/index.html">Overview</a></li>

                  <li><a class="" href="../install_config/advanced_ldap_configuration/sssd_for_ldap_failover.html">Setting up SSSD for LDAP Failover</a></li>

                  <li><a class="" href="../install_config/advanced_ldap_configuration/configuring_form_based_authentication.html">Configuring Form-Based Authentication</a></li>

                  <li><a class="" href="../install_config/advanced_ldap_configuration/configuring_extended_ldap_attributes.html">Configuring Extended LDAP Attributes</a></li>
              </ul>
            </li>
            <li><a class="" href="../install_config/web_console_customization.html">Customizing the Web Console</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-down"></span>Cluster Administration
      </a>
      <ul id="topicGroup3" class="collapse in list-unstyled">
            <li><a class="" href="../admin_guide/index.html">Overview</a></li>
            <li><a class="" href="../admin_guide/manage_users.html">Managing Users</a></li>
            <li><a class="" href="../admin_guide/managing_projects.html">Managing Projects</a></li>
            <li><a class="" href="../admin_guide/managing_pods.html">Managing Pods</a></li>
            <li><a class=" active" href="../admin_guide/service_accounts.html">Configuring Service Accounts</a></li>
            <li><a class="" href="../admin_guide/manage_authorization_policy.html">Managing Authorization Policies</a></li>
            <li><a class="" href="../admin_guide/image_policy.html">Image Policy</a></li>
            <li><a class="" href="../admin_guide/quota.html">Setting Quotas</a></li>
            <li><a class="" href="../admin_guide/multiproject_quota.html">Setting Multi-Project Quotas</a></li>
            <li><a class="" href="../admin_guide/limits.html">Setting Limit Ranges</a></li>
            <li><a class="" href="../admin_guide/allocating_node_resources.html">Allocating Node Resources</a></li>
            <li><a class="" href="../admin_guide/tcp_ingress_external_ports.html">Assigning Unique External IPs for Ingress Traffic</a></li>
            <li><a class="" href="../admin_guide/backup_restore.html">Backup and Restore</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>User Guide
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../dev_guide/index.html">Overview</a></li>
            <li><a class="" href="../dev_guide/authentication.html">Authentication</a></li>
            <li><a class="" href="../dev_guide/managing_images.html">Managing Images</a></li>
            <li><a class="" href="../dev_guide/service_accounts.html">Service Accounts</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>CLI Reference
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../cli_reference/index.html">Overview</a></li>
            <li><a class="" href="../cli_reference/get_started_cli.html">Get Started with the CLI</a></li>
            <li><a class="" href="../cli_reference/manage_cli_profiles.html">Managing CLI Profiles</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>REST API Reference
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../rest_api/index.html">Overview</a></li>
            <li><a class="" href="../rest_api/openshift_v1.html">OpenShift v1</a></li>
            <li><a class="" href="../rest_api/kubernetes_v1.html">Kubernetes v1</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Configuring Service Accounts</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#sa-user-names-and-groups">User Names and Groups</a></li>
<li><a href="#enabling-service-account-authentication">Enabling Service Account Authentication</a></li>
<li><a href="#managed-service-accounts">Managed Service Accounts</a></li>
<li><a href="#infrastructure-service-accounts">Infrastructure Service Accounts</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service accounts provide a flexible way to control API access without sharing a
regular user&#8217;s credentials.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sa-user-names-and-groups"><a class="anchor" href="#sa-user-names-and-groups"></a>User Names and Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every service account has an associated user name that can be granted roles,
just like a regular user. The user name is derived from its project and name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>system:serviceaccount:&lt;project&gt;:&lt;name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to add the <strong>view</strong> role to the <strong>robot</strong> service account in the
<strong>top-secret</strong> project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ oc policy add-role-to-user view system:serviceaccount:top-secret:robot</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Every service account is also a member of two groups:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">system:serviceaccounts</dt>
<dd>
<p>Includes all service accounts in the system.</p>
</dd>
<dt class="hdlist1">system:serviceaccounts:&lt;project&gt;</dt>
<dd>
<p>Includes all service accounts in the
specified project.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example, to allow all service accounts in all projects to view resources in
the <strong>top-secret</strong> project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ oc policy add-role-to-group view system:serviceaccounts -n top-secret</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To allow all service accounts in the <strong>managers</strong> project to edit resources in the
<strong>top-secret</strong> project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ oc policy add-role-to-group edit system:serviceaccounts:managers -n top-secret</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enabling-service-account-authentication"><a class="anchor" href="#enabling-service-account-authentication"></a>Enabling Service Account Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service accounts authenticate to the API using tokens signed by a private RSA
key. The authentication layer verifies the signature using a matching public RSA
key.</p>
</div>
<div class="paragraph">
<p>To enable service account token generation, update the <code><strong>serviceAccountConfig</strong></code>
stanza in the <strong><em>/etc/origin/master/master-config.yml</em></strong> file on the master to
specify a <code><strong>privateKeyFile</strong></code> (for signing), and a matching public key file in
the <code><strong>publicKeyFiles</strong></code> list:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>serviceAccountConfig:
  ...
  masterCA: ca.crt <i class="conum" data-value="1"></i><b>(1)</b>
  privateKeyFile: serviceaccounts.private.key <i class="conum" data-value="2"></i><b>(2)</b>
  publicKeyFiles:
  - serviceaccounts.public.key <i class="conum" data-value="3"></i><b>(3)</b>
  - ...</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>CA file used to validate the API server&#8217;s serving certificate.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Private RSA key file (for token signing).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Public RSA key files (for token verification). If private key files are
provided, then the public key component is used. Multiple public key files can
be specified, and a token will be accepted if it can be validated by one of the
public keys. This allows rotation of the signing key, while still accepting
tokens generated by the previous signer.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managed-service-accounts"><a class="anchor" href="#managed-service-accounts"></a>Managed Service Accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Service accounts are required in each project to run builds, deployments, and
other pods. The <code><strong>managedNames</strong></code> setting in the
<strong><em>/etc/origin/master/master-config.yml</em></strong> file on the master controls which
service accounts are automatically created in every project:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>serviceAccountConfig:
  ...
  managedNames: <i class="conum" data-value="1"></i><b>(1)</b>
  - builder <i class="conum" data-value="2"></i><b>(2)</b>
  - deployer <i class="conum" data-value="3"></i><b>(3)</b>
  - default <i class="conum" data-value="4"></i><b>(4)</b>
  - ...</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>List of service accounts to automatically create in every project.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <strong>builder</strong> service account in each project is required by build pods, and is
given the <strong>system:image-builder</strong> role, which allows pushing images to any image
stream in the project using the internal Docker registry.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A <strong>deployer</strong> service account in each project is required by deployment pods, and
is given the <strong>system:deployer</strong> role, which allows viewing and modifying
replication controllers and pods in the project.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>A <strong>default</strong> service account is used by all other pods unless they specify a
different service account.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>All service accounts in a project are given the <strong>system:image-puller</strong> role,
which allows pulling images from any image stream in the project using the
internal Docker registry.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="infrastructure-service-accounts"><a class="anchor" href="#infrastructure-service-accounts"></a>Infrastructure Service Accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several infrastructure controllers run using service account credentials. The
following service accounts are created in the Atomic Registry infrastructure
project (<strong>openshift-infra</strong>) at server start, and given the following roles
cluster-wide:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service Account</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>replication-controller</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned the <strong>system:replication-controller</strong> role</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>deployment-controller</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned the <strong>system:deployment-controller</strong> role</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>build-controller</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigned the <strong>system:build-controller</strong> role. Additionally, the
<strong>build-controller</strong> service account is included in the privileged
<a href="manage_scc.html#admin-guide-manage-scc">security context constraint</a> in order to create privileged
build pods.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To configure the project where those service accounts are created, set the
<code><strong>openshiftInfrastructureNamespace</strong></code> field in in the
<strong><em>/etc/origin/master/master-config.yml</em></strong> file on the master:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>policyConfig:
  ...
  openshiftInfrastructureNamespace: openshift-infra</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Set the <code><strong>limitSecretReferences</strong></code> field in the
<strong><em>/etc/origin/master/master-config.yml</em></strong> file on the master to <code>true</code> to require
pod secret references to be whitelisted by their service accounts. Set its value
to <code>false</code> to allow pods to reference any secret in the project.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre>serviceAccountConfig:
  ...
  limitSecretReferences: false</pre>
</div>
</div>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
    <footer class="footer-openshift">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-4 col-md-3">
      </div>
      <div class="col-xs-12 col-sm-4 col-md-6 text-center">
        <div class="row">
          <div class="col-xs-12 col-md-4">
          </div>
          <div class="col-xs-12 col-md-4">
          </div>
          <div class="col-xs-12 col-md-4">
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-3 text-right">
        <a id="built_with_asciibinder" href="http://asciibinder.org/">
          <img src="http://docs.thedigitalgarage.io/_images/asciibinder_web_logo.svg" alt="AsciiBinder" />
        </a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>