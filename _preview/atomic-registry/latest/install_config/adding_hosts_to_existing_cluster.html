<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Atomic Registry | Installation and Configuration | Adding Hosts to an Existing Cluster</title>
  <link href="/_stylesheets/subdomain.css" rel="stylesheet" type="text/css">
  <link href="/_stylesheets/docs.css" rel="stylesheet" type="text/css"/>
  <link href="/_stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css"/>
  <!--
  <link href="https://raw.githubusercontent.com/thedigitalgarage/origin-web-console/master/extensions/thedigitalgarage/css/main.css" rel="stylesheet" type="text/css">
  -->
  <link href="/_images/favicon.png" rel="apple-touch-icon-precomposed" type="image/png">
  <link href="/_images/favicon.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="the Digital Garage" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://assets.openshift.net/content/html5shiv.js" type="text/javascript"></script>
    <script src="https://assets.openshift.net/content/respond.js" type="text/javascript"></script>
    <link href="https://assets.openshift.net/content/vendor/respond-js/respond-proxy.html" id="respond-proxy" rel="respond-proxy">
    <link href="/_images/respond.proxy.gif" id="respond-redirect" rel="respond-redirect">
    <script src="/_javascripts/respond.proxy.js" type="text/javascript"></script>
  <![endif]-->
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/app/assets/site/tracking.js" type="text/javascript"></script>
  <script type="text/javascript" src="https://assets.openshift.net/app/assets/site/tracking.js"></script>
</head>
<body>
  <div class="navbar navbar-default navbar-openshift" role="navigation">
  <div class="navbar-header">
    <a class="navbar-brand" href="/"></a>
  </div>
  <div class="navbar-collapse collapse">
  </div>
</div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Atomic Registry Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../registry_quickstart/index.html">Atomic Registry Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../install_config/adding_hosts_to_existing_cluster.html">Installation and Configuration</a>
      </li>
      
      <li class="hidden-xs active">
        Adding Hosts to an Existing Cluster
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <div class="row-fluid">
          
<script>
  (function() {
    var cx = '013769182564158614814:e-dp46b51vk';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>

        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Quickstart
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../registry_quickstart/index.html">Overview</a></li>
            <li><a class="" href="../registry_quickstart/developers.html">Developers</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-0-2">
                <span id="sgSpan-0-2" class="fa fa-caret-right"></span>&nbsp;Administrators
              </a>
              <ul id="topicSubGroup-0-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../registry_quickstart/administrators/index.html">Overview</a></li>

                  <li><a class="" href="../registry_quickstart/administrators/system_configuration.html">System Configuration</a></li>

                  <li><a class="" href="../registry_quickstart/administrators/uninstall.html">Uninstall</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-1-0">
                <span id="sgSpan-1-0" class="fa fa-caret-right"></span>&nbsp;Core Concepts
              </a>
              <ul id="topicSubGroup-1-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../architecture/core_concepts/containers_and_images.html">Images</a></li>

                  <li><a class="" href="../architecture/core_concepts/projects_and_users.html">Projects and Users</a></li>

                  <li><a class="" href="../architecture/core_concepts/builds_and_image_streams.html">Image Streams</a></li>
              </ul>
            </li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-down"></span>Installation and Configuration
      </a>
      <ul id="topicGroup2" class="collapse in list-unstyled">
            <li><a class=" active" href="../install_config/adding_hosts_to_existing_cluster.html">Adding Hosts to an Existing Cluster</a></li>
            <li><a class="" href="../install_config/certificate_customization.html">Configuring Custom Certificates</a></li>
            <li><a class="" href="../install_config/redeploying_certificates.html">Redeploying Certificates</a></li>
            <li><a class="" href="../install_config/configuring_authentication.html">Configuring Authentication and User Agent</a></li>
            <li><a class="" href="../install_config/syncing_groups_with_ldap.html">Syncing Groups With LDAP</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-2-5">
                <span id="sgSpan-2-5" class="fa fa-caret-right"></span>&nbsp;Advanced LDAP Configuration
              </a>
              <ul id="topicSubGroup-2-5" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../install_config/advanced_ldap_configuration/index.html">Overview</a></li>

                  <li><a class="" href="../install_config/advanced_ldap_configuration/sssd_for_ldap_failover.html">Setting up SSSD for LDAP Failover</a></li>

                  <li><a class="" href="../install_config/advanced_ldap_configuration/configuring_form_based_authentication.html">Configuring Form-Based Authentication</a></li>

                  <li><a class="" href="../install_config/advanced_ldap_configuration/configuring_extended_ldap_attributes.html">Configuring Extended LDAP Attributes</a></li>
              </ul>
            </li>
            <li><a class="" href="../install_config/web_console_customization.html">Customizing the Web Console</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Cluster Administration
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../admin_guide/index.html">Overview</a></li>
            <li><a class="" href="../admin_guide/manage_users.html">Managing Users</a></li>
            <li><a class="" href="../admin_guide/managing_projects.html">Managing Projects</a></li>
            <li><a class="" href="../admin_guide/managing_pods.html">Managing Pods</a></li>
            <li><a class="" href="../admin_guide/service_accounts.html">Configuring Service Accounts</a></li>
            <li><a class="" href="../admin_guide/manage_authorization_policy.html">Managing Authorization Policies</a></li>
            <li><a class="" href="../admin_guide/image_policy.html">Image Policy</a></li>
            <li><a class="" href="../admin_guide/quota.html">Setting Quotas</a></li>
            <li><a class="" href="../admin_guide/multiproject_quota.html">Setting Multi-Project Quotas</a></li>
            <li><a class="" href="../admin_guide/limits.html">Setting Limit Ranges</a></li>
            <li><a class="" href="../admin_guide/allocating_node_resources.html">Allocating Node Resources</a></li>
            <li><a class="" href="../admin_guide/tcp_ingress_external_ports.html">Assigning Unique External IPs for Ingress Traffic</a></li>
            <li><a class="" href="../admin_guide/backup_restore.html">Backup and Restore</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>User Guide
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../dev_guide/index.html">Overview</a></li>
            <li><a class="" href="../dev_guide/authentication.html">Authentication</a></li>
            <li><a class="" href="../dev_guide/managing_images.html">Managing Images</a></li>
            <li><a class="" href="../dev_guide/service_accounts.html">Service Accounts</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>CLI Reference
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../cli_reference/index.html">Overview</a></li>
            <li><a class="" href="../cli_reference/get_started_cli.html">Get Started with the CLI</a></li>
            <li><a class="" href="../cli_reference/manage_cli_profiles.html">Managing CLI Profiles</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>REST API Reference
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../rest_api/index.html">Overview</a></li>
            <li><a class="" href="../rest_api/openshift_v1.html">OpenShift v1</a></li>
            <li><a class="" href="../rest_api/kubernetes_v1.html">Kubernetes v1</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Adding Hosts to an Existing Cluster</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#adding-nodes-or-reinstalling-quick">Adding Hosts Using the Quick Installer Tool</a></li>
<li><a href="#adding-nodes-advanced">Adding Hosts Using the Advanced Install</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Depending on how your Atomic Registry cluster was installed, you can add new
hosts (either nodes or masters) to your installation by using the install tool
for quick installations, or by using the <strong><em>scaleup.yml</em></strong> playbook for advanced
installations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-nodes-or-reinstalling-quick"><a class="anchor" href="#adding-nodes-or-reinstalling-quick"></a>Adding Hosts Using the Quick Installer Tool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you used the quick install tool to install your Atomic Registry cluster, you
can use the quick install tool to add a new node host to your existing cluster,
or to reinstall the cluster entirely.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, you can not use the quick installer tool to add new master hosts. You
must use the
<a href="../install_config/install/advanced_install.html#install-config-install-advanced-install">advanced
installation</a> method to do so.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you used the installer in either
<a href="../install_config/install/quick_install.html#running-an-interactive-installation">interactive</a> or
<a href="../install_config/install/quick_install.html#running-an-unattended-installation">unattended</a> mode, you can re-run the
installation as long as you have an
<a href="../install_config/install/quick_install.html#defining-an-installation-configuration-file">installation configuration
file</a> at <strong><em>~/.config/openshift/installer.cfg.yml</em></strong> (or specify a different
location with the <code>-c</code> option).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The recommended maximum number of nodes is 300.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To add nodes to your installation:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Re-run the installer with the <code>install</code> subcommand in interactive or
unattended mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ atomic-openshift-installer [-u] [-c &lt;/path/to/file&gt;] install</pre>
</div>
</div>
</li>
<li>
<p>The installer detects your current environment and allows you to either
add an additional node or re-perform a clean install:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">Gathering information from hosts...
Installed environment detected.
By default the installer only adds new nodes to an installed environment.
Do you want to (1) only add additional nodes or (2) perform a clean install?:</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Choose (1) and follow the on-screen instructions to complete your desired task.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-nodes-advanced"><a class="anchor" href="#adding-nodes-advanced"></a>Adding Hosts Using the Advanced Install</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you installed using the advanced install, you can add new hosts to your
cluster by running the <strong><em>scaleup.yml</em></strong> playbook. This playbook queries the
master, generates and distributes new certificates for the new hosts, then runs
the configuration playbooks on the new hosts only. Before running the
<strong><em>scaleup.yml</em></strong> playbook, complete all prerequisite
<a href="../install_config/install/host_preparation.html#install-config-install-host-preparation">host
preparation</a> steps.</p>
</div>
<div class="paragraph">
<p>You must have an existing inventory file (for example, <strong><em>/etc/ansible/hosts</em></strong>)
that is representative of your current cluster configuration in order to run the
<strong><em>scaleup.yml</em></strong> playbook.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The recommended maximum number of nodes is 300.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To add a host to an existing cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you have the latest playbooks by updating the <strong>atomic-openshift-utils</strong>
package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update atomic-openshift-utils</pre>
</div>
</div>
</li>
<li>
<p>Edit your <strong><em>/etc/ansible/hosts</em></strong> file and add <strong>new_&lt;host_type&gt;</strong> to the
<strong>[OSEv3:children]</strong> section:</p>
<div class="paragraph">
<p>For example, to add a new node host, add <strong>new_nodes</strong>:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">[OSEv3:children]
masters
nodes
new_nodes</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To add new master hosts, add <strong>new_masters</strong>.</p>
</div>
</li>
<li>
<p>Create a <strong>[new_&lt;host_type&gt;]</strong> section much like an existing section,
specifying host information for any new hosts you want to add. For example,
when adding a new node:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">[nodes]
master[1:3].example.com openshift_node_labels="{'region': 'infra', 'zone': 'default'}"
node1.example.com openshift_node_labels="{'region': 'primary', 'zone': 'east'}"
node2.example.com openshift_node_labels="{'region': 'primary', 'zone': 'west'}"

[new_nodes]
node3.example.com openshift_node_labels="{'region': 'primary', 'zone': 'west'}"</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See
<a href="../install_config/install/advanced_install.html#advanced-host-variables">Configuring
Host Variables</a> for more options.</p>
</div>
<div class="paragraph">
<p>When adding new masters, hosts added to the <strong>[new_masters]</strong> section must also be
added to the <strong>[new_nodes]</strong> section with the <code><strong>openshift_schedulable=false</strong></code>
variable. This ensures the new master host is part of the OpenShift SDN and that
pods are not scheduled for placement on them. For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">[masters]
master[1:2].example.com

[new_masters]
master3.example.com

[nodes]
node[1:3].example.com openshift_node_labels="{'region': 'infra'}"
master[1:2].example.com openshift_schedulable=false

[new_nodes]
master3.example.com openshift_schedulable=false</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Run the <strong><em>scaleup.yml</em></strong> playbook. If your inventory file is located somewhere
other than the default of <strong><em>/etc/ansible/hosts</em></strong>, specify the location with the
<code>-i option</code>.</p>
<div class="paragraph">
<p>For additional nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook [-i /path/to/file] \
    /usr/share/ansible/openshift-ansible/playbooks/byo/openshift-node/scaleup.yml</pre>
</div>
</div>
<div class="paragraph">
<p>For additional masters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook [-i /path/to/file] \
    usr/share/ansible/openshift-ansible/playbooks/byo/openshift-master/scaleup.yml</pre>
</div>
</div>
</li>
<li>
<p>After the playbook completes successfully,
<a href="../install_config/install/advanced_install.html#advanced-verifying-the-installation">verify the installation</a>.</p>
</li>
<li>
<p>Finally, move any hosts you had defined in the <strong>[new_&lt;host_type&gt;]</strong> section
into their appropriate section (but leave the <strong>[new_&lt;host_type&gt;]</strong> section
definition itself in place) so that subsequent runs using this inventory file
are aware of the nodes but do not handle them as new nodes. For example, when
adding new nodes:</p>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">[nodes]
master[1:3].example.com openshift_node_labels="{'region': 'infra', 'zone': 'default'}"
node1.example.com openshift_node_labels="{'region': 'primary', 'zone': 'east'}"
node2.example.com openshift_node_labels="{'region': 'primary', 'zone': 'west'}"
node3.example.com openshift_node_labels="{'region': 'primary', 'zone': 'west'}"

[new_nodes]</pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
    <footer class="footer-openshift">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-4 col-md-3">
      </div>
      <div class="col-xs-12 col-sm-4 col-md-6 text-center">
        <div class="row">
          <div class="col-xs-12 col-md-4">
          </div>
          <div class="col-xs-12 col-md-4">
          </div>
          <div class="col-xs-12 col-md-4">
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-3 text-right">
        <a id="built_with_asciibinder" href="http://asciibinder.org/">
          <img src="http://docs.thedigitalgarage.io/_images/asciibinder_web_logo.svg" alt="AsciiBinder" />
        </a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>