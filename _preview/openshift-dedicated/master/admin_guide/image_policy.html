<!DOCTYPE html>
<!--[if IE 8]> <html class="ie8"> <![endif]-->
<!--[if IE 9]> <html class="ie9"> <![endif]-->
<!--[if gt IE 9]><!-->
<html>
<!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>OpenShift Dedicated | Cluster Administration | Image Policy</title>
  <link href="/_stylesheets/subdomain.css" rel="stylesheet" type="text/css">
  <link href="/_stylesheets/docs.css" rel="stylesheet" type="text/css"/>
  <link href="/_stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css"/>
  <!--
  <link href="https://raw.githubusercontent.com/thedigitalgarage/origin-web-console/master/extensions/thedigitalgarage/css/main.css" rel="stylesheet" type="text/css">
  -->
  <link href="/_images/favicon.png" rel="apple-touch-icon-precomposed" type="image/png">
  <link href="/_images/favicon.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="https://assets.openshift.net/content/subdomain/favicon.ico"><![endif]-->
  <!-- or, set /favicon.ico for IE10 win -->
  <meta content="the Digital Garage" name="application-name">
  <meta content="#000000" name="msapplication-TileColor">
  <meta content="https://assets.openshift.net/content/subdomain/touch-icon-precomposed.png" name="msapplication-TileImage">
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://assets.openshift.net/content/html5shiv.js" type="text/javascript"></script>
    <script src="https://assets.openshift.net/content/respond.js" type="text/javascript"></script>
    <link href="https://assets.openshift.net/content/vendor/respond-js/respond-proxy.html" id="respond-proxy" rel="respond-proxy">
    <link href="../../master/_images/respond.proxy.gif" id="respond-redirect" rel="respond-redirect">
    <script src="../../master/_javascripts/respond.proxy.js" type="text/javascript"></script>
  <![endif]-->
  <script src="https://assets.openshift.net/content/modernizr.js" type="text/javascript"></script>
  <script src="https://assets.openshift.net/content/subdomain.js" type="text/javascript"></script>
  <script src="http://docs.thedigitalgarage.io/_javascripts/bootstrap-offcanvas.js")" type="text/javascript"></script>
  <script type="text/javascript" src="https://assets.openshift.net/app/assets/site/tracking.js"></script>
</head>
<body>
  <div class="navbar navbar-default navbar-openshift" role="navigation">
  <div class="navbar-header">
    <a class="navbar-brand" href="/"></a>
  </div>
  <div class="navbar-collapse collapse">
  </div>
</div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../welcome/index.html">OpenShift Dedicated Branch Build</a>
      </li>
      <li class="hidden-xs active">
        <a href="../admin_guide/index.html">Cluster Administration</a>
      </li>
      
      <li class="hidden-xs active">
        Image Policy
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <div class="row-fluid">
          
<script>
  (function() {
    var cx = '013769182564158614814:ykypjfbua0a';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search defaultToRefinement="Dedicated Branch Build"></gcse:search>

        </div>
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>About
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
            <li><a class="" href="../welcome/revhistory_all.html">All Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Release Notes
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../release_notes/index.html">Overview</a></li>
            <li><a class="" href="../release_notes/osd_3_2_release_notes.html">OpenShift Dedicated 3.2 Release Notes</a></li>
            <li><a class="" href="../release_notes/v2_vs_v3.html">Comparing OpenShift Enterprise 2 and OpenShift Enterprise 3</a></li>
            <li><a class="" href="../release_notes/revhistory_release_notes.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Getting Started
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../getting_started/index.html">Overview</a></li>
            <li><a class="" href="../getting_started/developers_console.html">Web Console Walkthrough</a></li>
            <li><a class="" href="../getting_started/developers_cli.html">Command-Line Walkthrough</a></li>
            <li><a class="" href="../getting_started/dedicated_administrators.html">Administering a Cluster</a></li>
            <li><a class="" href="../getting_started/revhistory_getting_started.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/index.html">Overview</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-1">
                <span id="sgSpan-3-1" class="fa fa-caret-right"></span>&nbsp;Infrastructure Components
              </a>
              <ul id="topicSubGroup-3-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../architecture/infrastructure_components/kubernetes_infrastructure.html">Kubernetes Infrastructure</a></li>

                  <li><a class="" href="../architecture/infrastructure_components/image_registry.html">Image Registry</a></li>

                  <li><a class="" href="../architecture/infrastructure_components/web_console.html">Web Console</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-2">
                <span id="sgSpan-3-2" class="fa fa-caret-right"></span>&nbsp;Core Concepts
              </a>
              <ul id="topicSubGroup-3-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../architecture/core_concepts/index.html">Overview</a></li>

                  <li><a class="" href="../architecture/core_concepts/containers_and_images.html">Containers and Images</a></li>

                  <li><a class="" href="../architecture/core_concepts/pods_and_services.html">Pods and Services</a></li>

                  <li><a class="" href="../architecture/core_concepts/projects_and_users.html">Projects and Users</a></li>

                  <li><a class="" href="../architecture/core_concepts/builds_and_image_streams.html">Builds and Image Streams</a></li>

                  <li><a class="" href="../architecture/core_concepts/deployments.html">Deployments</a></li>

                  <li><a class="" href="../architecture/core_concepts/routes.html">Routes</a></li>

                  <li><a class="" href="../architecture/core_concepts/templates.html">Templates</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-3-3">
                <span id="sgSpan-3-3" class="fa fa-caret-right"></span>&nbsp;Additional Concepts
              </a>
              <ul id="topicSubGroup-3-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../architecture/additional_concepts/networking.html">Networking</a></li>

                  <li><a class="" href="../architecture/additional_concepts/sdn.html">OpenShift SDN</a></li>

                  <li><a class="" href="../architecture/additional_concepts/authentication.html">Authentication</a></li>

                  <li><a class="" href="../architecture/additional_concepts/authorization.html">Authorization</a></li>

                  <li><a class="" href="../architecture/additional_concepts/storage.html">Persistent Storage</a></li>

                  <li><a class="" href="../architecture/additional_concepts/remote_commands.html">Remote Commands</a></li>

                  <li><a class="" href="../architecture/additional_concepts/port_forwarding.html">Port Forwarding</a></li>

                  <li><a class="" href="../architecture/additional_concepts/throttling.html">Throttling</a></li>

                  <li><a class="" href="../architecture/additional_concepts/scm.html">Source Control Management</a></li>

                  <li><a class="" href="../architecture/additional_concepts/admission_controllers.html">Admission Controllers</a></li>

                  <li><a class="" href="../architecture/additional_concepts/other_api_objects.html">Other API Objects</a></li>
              </ul>
            </li>
            <li><a class="" href="../architecture/revhistory_architecture.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-down"></span>Cluster Administration
      </a>
      <ul id="topicGroup4" class="collapse in list-unstyled">
            <li><a class="" href="../admin_guide/index.html">Overview</a></li>
            <li><a class="" href="../admin_guide/managing_projects.html">Managing Projects</a></li>
            <li><a class="" href="../admin_guide/service_accounts.html">Configuring Service Accounts</a></li>
            <li><a class="" href="../admin_guide/manage_authorization_policy.html">Managing Authorization Policies</a></li>
            <li><a class=" active" href="../admin_guide/image_policy.html">Image Policy</a></li>
            <li><a class="" href="../admin_guide/osd_imagestreams_templates.html">Managing the Default Image Streams and Templates</a></li>
            <li><a class="" href="../admin_guide/manage_scc.html">Managing Security Context Constraints</a></li>
            <li><a class="" href="../admin_guide/quota.html">Setting Quotas</a></li>
            <li><a class="" href="../admin_guide/multiproject_quota.html">Setting Multi-Project Quotas</a></li>
            <li><a class="" href="../admin_guide/limits.html">Setting Limit Ranges</a></li>
            <li><a class="" href="../admin_guide/pruning_resources.html">Pruning Objects</a></li>
            <li><a class="" href="../admin_guide/garbage_collection.html">Garbage Collection</a></li>
            <li><a class="" href="../admin_guide/scheduler.html">Scheduler</a></li>
            <li><a class="" href="../admin_guide/osd_build_defaults_overrides.html">Configuring Global Build Defaults and Overrides</a></li>
            <li><a class="" href="../admin_guide/osd_configuring_pipeline_execution.html">Configuring Build Pipeline Execution</a></li>
            <li><a class="" href="../admin_guide/limit_pod_access_egress.html">Limit Pod Access with Egress Firewall</a></li>
            <li><a class="" href="../admin_guide/pod_network.html">Managing Pod Networks</a></li>
            <li><a class="" href="../admin_guide/backup_restore.html">Backup and Restore</a></li>
            <li><a class="" href="../admin_guide/revhistory_admin_guide.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-right"></span>CLI Reference
      </a>
      <ul id="topicGroup5" class="collapse  list-unstyled">
            <li><a class="" href="../cli_reference/index.html">Overview</a></li>
            <li><a class="" href="../cli_reference/get_started_cli.html">Get Started with the CLI</a></li>
            <li><a class="" href="../cli_reference/manage_cli_profiles.html">Managing CLI Profiles</a></li>
            <li><a class="" href="../cli_reference/basic_cli_operations.html">Developer CLI Operations</a></li>
            <li><a class="" href="../cli_reference/admin_cli_operations.html">Administrator CLI Operations</a></li>
            <li><a class="" href="../cli_reference/revhistory_cli_reference.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>Developer Guide
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../dev_guide/index.html">Overview</a></li>
            <li><a class="" href="../dev_guide/application_lifecycle.html">Application Life Cycle Examples</a></li>
            <li><a class="" href="../dev_guide/authentication.html">Authentication</a></li>
            <li><a class="" href="../dev_guide/projects.html">Projects</a></li>
            <li><a class="" href="../dev_guide/new_app.html">Creating New Applications</a></li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-5">
                <span id="sgSpan-6-5" class="fa fa-caret-right"></span>&nbsp;Migrating Applications
              </a>
              <ul id="topicSubGroup-6-5" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../dev_guide/migrating_applications/index.html">Overview</a></li>

                  <li><a class="" href="../dev_guide/migrating_applications/database_applications.html">Database Applications</a></li>

                  <li><a class="" href="../dev_guide/migrating_applications/web_framework_applications.html">Web Framework Applications</a></li>

                  <li><a class="" href="../dev_guide/migrating_applications/quickstart_examples.html">QuickStart Examples</a></li>

                  <li><a class="" href="../dev_guide/migrating_applications/continuous_integration_and_deployment.html">Continuous Integration and Deployment</a></li>

                  <li><a class="" href="../dev_guide/migrating_applications/web_hooks_action_hooks.html">Webhooks and Action Hooks</a></li>

                  <li><a class="" href="../dev_guide/migrating_applications/S2I_tool.html">S2I Tool</a></li>

                  <li><a class="" href="../dev_guide/migrating_applications/support_guide.html">Support Guide</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-6-6">
                <span id="sgSpan-6-6" class="fa fa-caret-right"></span>&nbsp;Application Tutorials
              </a>
              <ul id="topicSubGroup-6-6" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../dev_guide/app_tutorials/index.html">Overview</a></li>

                  <li><a class="" href="../dev_guide/app_tutorials/quickstarts.html">Quickstart Templates</a></li>

                  <li><a class="" href="../dev_guide/app_tutorials/ruby_on_rails.html">Ruby on Rails</a></li>

                  <li><a class="" href="../dev_guide/app_tutorials/maven_tutorial.html">Setting Up a Nexus Mirror</a></li>
              </ul>
            </li>
            <li><a class="" href="../dev_guide/ssh_environment.html">Opening a Remote Shell to Containers</a></li>
            <li><a class="" href="../dev_guide/templates.html">Templates</a></li>
            <li><a class="" href="../dev_guide/service_accounts.html">Service Accounts</a></li>
            <li><a class="" href="../dev_guide/builds.html">Builds</a></li>
            <li><a class="" href="../dev_guide/managing_images.html">Managing Images</a></li>
            <li><a class="" href="../dev_guide/compute_resources.html">Quotas and Limit Ranges</a></li>
            <li><a class="" href="../dev_guide/deployments.html">Deployments</a></li>
            <li><a class="" href="../dev_guide/routes.html">Routes</a></li>
            <li><a class="" href="../dev_guide/integrating_external_services.html">Integrating External Services</a></li>
            <li><a class="" href="../dev_guide/secrets.html">Secrets</a></li>
            <li><a class="" href="../dev_guide/configmaps.html">ConfigMaps</a></li>
            <li><a class="" href="../dev_guide/pod_autoscaling.html">Pod Autoscaling</a></li>
            <li><a class="" href="../dev_guide/volumes.html">Managing Volumes</a></li>
            <li><a class="" href="../dev_guide/persistent_volumes.html">Using Persistent Volumes</a></li>
            <li><a class="" href="../dev_guide/executing_remote_commands.html">Executing Remote Commands</a></li>
            <li><a class="" href="../dev_guide/copy_files_to_container.html">Copying Files</a></li>
            <li><a class="" href="../dev_guide/port_forwarding.html">Port Forwarding</a></li>
            <li><a class="" href="../dev_guide/shared_memory.html">Shared Memory</a></li>
            <li><a class="" href="../dev_guide/application_health.html">Application Health</a></li>
            <li><a class="" href="../dev_guide/events.html">Events</a></li>
            <li><a class="" href="../dev_guide/downward_api.html">Downward API</a></li>
            <li><a class="" href="../dev_guide/environment_variables.html">Managing Environment Variables</a></li>
            <li><a class="" href="../dev_guide/jobs.html">Jobs</a></li>
            <li><a class="" href="../dev_guide/revhistory_dev_guide.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup7">
        <span id="tgSpan7" class="fa fa-angle-right"></span>Creating Images
      </a>
      <ul id="topicGroup7" class="collapse  list-unstyled">
            <li><a class="" href="../creating_images/index.html">Overview</a></li>
            <li><a class="" href="../creating_images/guidelines.html">Guidelines</a></li>
            <li><a class="" href="../creating_images/metadata.html">Image Metadata</a></li>
            <li><a class="" href="../creating_images/s2i.html">S2I Requirements</a></li>
            <li><a class="" href="../creating_images/s2i_testing.html">Testing S2I Images</a></li>
            <li><a class="" href="../creating_images/custom.html">Custom Builder</a></li>
            <li><a class="" href="../creating_images/revhistory_creating_images.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup8">
        <span id="tgSpan8" class="fa fa-angle-right"></span>Using Images
      </a>
      <ul id="topicGroup8" class="collapse  list-unstyled">
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-8-0">
                <span id="sgSpan-8-0" class="fa fa-caret-right"></span>&nbsp;Source-to-Image (S2I)
              </a>
              <ul id="topicSubGroup-8-0" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../using_images/s2i_images/index.html">Overview</a></li>

                  <li><a class="" href="../using_images/s2i_images/customizing_s2i_images.html">Customizing S2I images</a></li>

                  <li><a class="" href="../using_images/s2i_images/nodejs.html">Node.js</a></li>

                  <li><a class="" href="../using_images/s2i_images/ruby.html">Ruby</a></li>

                  <li><a class="" href="../using_images/s2i_images/perl.html">Perl</a></li>

                  <li><a class="" href="../using_images/s2i_images/php.html">PHP</a></li>

                  <li><a class="" href="../using_images/s2i_images/python.html">Python</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-8-1">
                <span id="sgSpan-8-1" class="fa fa-caret-right"></span>&nbsp;Database Images
              </a>
              <ul id="topicSubGroup-8-1" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../using_images/db_images/index.html">Overview</a></li>

                  <li><a class="" href="../using_images/db_images/mysql.html">MySQL</a></li>

                  <li><a class="" href="../using_images/db_images/postgresql.html">PostgreSQL</a></li>

                  <li><a class="" href="../using_images/db_images/mongodb.html">MongoDB</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-8-2">
                <span id="sgSpan-8-2" class="fa fa-caret-right"></span>&nbsp;Docker Images
              </a>
              <ul id="topicSubGroup-8-2" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../using_images/docker_images/index.html">Overview</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-8-3">
                <span id="sgSpan-8-3" class="fa fa-caret-right"></span>&nbsp;Other Images
              </a>
              <ul id="topicSubGroup-8-3" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../using_images/other_images/index.html">Overview</a></li>

                  <li><a class="" href="../using_images/other_images/jenkins.html">Jenkins</a></li>
              </ul>
            </li>
            <li class="nav-header">
              <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicSubGroup-8-4">
                <span id="sgSpan-8-4" class="fa fa-caret-right"></span>&nbsp;xPaaS Middleware Images
              </a>
              <ul id="topicSubGroup-8-4" class="nav-tertiary list-unstyled collapse">

                  <li><a class="" href="../using_images/xpaas_images/index.html">Overview</a></li>
              </ul>
            </li>
            <li><a class="" href="../using_images/revhistory_using_images.html">Revision History</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="javascript:void(0);" data-toggle="collapse" data-target="#topicGroup9">
        <span id="tgSpan9" class="fa fa-angle-right"></span>REST API Reference
      </a>
      <ul id="topicGroup9" class="collapse  list-unstyled">
            <li><a class="" href="../rest_api/index.html">Overview</a></li>
            <li><a class="" href="../rest_api/openshift_v1.html">OpenShift v1</a></li>
            <li><a class="" href="../rest_api/kubernetes_v1.html">Kubernetes v1</a></li>
            <li><a class="" href="../rest_api/revhistory_rest_api.html">Revision History</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Image Policy</h2>
        </div>
        <div id="preamble">
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a></li>
<li><a href="#image-policy-configuring-the-image-policy-admission-plug-in">Configuring the ImagePolicy Admission Plug-in</a></li>
<li><a href="#image-policy-testing-image-policy-admission-plug-in">Testing the ImagePolicy Admission Plug-in</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can control which images are allowed to run on your cluster using the ImagePolicy
admission plug-in (currently considered beta). It allows you to control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>The source of images</strong>: which registries can be used to pull images</p>
</li>
<li>
<p><strong>Image resolution</strong>: force pods to run with immutable digests to ensure the image does not change due to a re-tag</p>
</li>
<li>
<p><strong>Docker image label restrictions</strong>: force an image to have or not have particular labels</p>
</li>
<li>
<p><strong>Image annotation restrictions</strong>: force an image in the integration docker registry to have or not have particular annotations</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="image-policy-configuring-the-image-policy-admission-plug-in"><a class="anchor" href="#image-policy-configuring-the-image-policy-admission-plug-in"></a>Configuring the ImagePolicy Admission Plug-in</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable this feature, configure the plug-in in <code><strong><em>master-config.yaml</em></strong></code>:</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Annotated Example File</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">admissionConfig</span>:
  <span style="color:#606">pluginConfig</span>:
    <span style="color:#606">openshift.io/ImagePolicy</span>:
      <span style="color:#606">configuration</span>:
        <span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">ImagePolicyConfig</span></span>
        <span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">v1</span></span>
        <span style="color:#606">resolveImages</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">AttemptRewrite </span></span><i class="conum" data-value="1"></i><b>(1)</b>
        <span style="color:#606">executionRules</span>: <i class="conum" data-value="2"></i><b>(2)</b>
        - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: execution-denied</span></span>
          <span style="color:#777"># Reject all images that have the annotation images.openshift.io/deny-execution set to true.</span>
          <span style="color:#777"># This annotation may be set by infrastructure that wishes to flag particular images as dangerous</span>
          <span style="color:#606">onResources</span>: <i class="conum" data-value="3"></i><b>(3)</b>
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">resource: pods</span></span>
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">resource: builds</span></span>
          <span style="color:#606">reject</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="4"></i><b>(4)</b>
          <span style="color:#606">matchImageAnnotations</span>: <i class="conum" data-value="5"></i><b>(5)</b>
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">key: images.openshift.io/deny-execution</span></span>
            <span style="color:#606">value</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">true</span><span style="color:#710">&quot;</span></span>
          <span style="color:#606">skipOnResolutionFailure</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true </span></span><i class="conum" data-value="6"></i><b>(6)</b>
        - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: allow-images-from-internal-registry</span></span>
          <span style="color:#777"># allows images from the internal registry and tries to resolve them</span>
          <span style="color:#606">onResources</span>:
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">resource: pods</span></span>
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">resource: builds</span></span>
          <span style="color:#606">matchIntegratedRegistry</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">true</span></span>
        - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: allow-images-from-dockerhub</span></span>
          <span style="color:#606">onResources</span>:
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">resource: pods</span></span>
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">resource: builds</span></span>
          <span style="color:#606">matchRegistries</span>:
          - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">docker.io</span></span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Try to resolve images to an immutable image digest and update the image pull specification in the pod.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Array of rules to evaluate against incoming resources. If you only have reject==true rules,
the default is <strong>allow all</strong>. If you have any accept rule, the default is <strong>deny all</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Indicates which resources to enforce rules upon. If nothing is specified, the default is <strong>pods</strong>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Indicates that if this rule matches, the pod should be rejected.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>List of annotations to match on the image object&#8217;s metadata.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If you are not able to resolve the image, do not fail the pod.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="image-policy-testing-image-policy-admission-plug-in"><a class="anchor" href="#image-policy-testing-image-policy-admission-plug-in"></a>Testing the ImagePolicy Admission Plug-in</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>openshift/image-policy-check</code> to test your configuration.</p>
<div class="paragraph">
<p>For example, use the information above, then test like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc import-image openshift/image-policy-check:latest --confirm</pre>
</div>
</div>
</li>
<li>
<p>Create a pod using this YAML. The pod should be created.</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Pod
metadata:
  generateName: test-pod
spec:
  containers:
  - image: docker.io/openshift/image-policy-check:latest
    name: first</pre>
</div>
</div>
</li>
<li>
<p>Create another pod pointing to a different registry. The pod should be rejected.</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Pod
metadata:
  generateName: test-pod
spec:
  containers:
  - image: different-registry/openshift/image-policy-check:latest
    name: first</pre>
</div>
</div>
</li>
<li>
<p>Create a pod pointing to the internal registry using the imported image. The pod
should be created and if you look at the image specification, you should see a
digest in place of the tag.</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Pod
metadata:
  generateName: test-pod
spec:
  containers:
  - image: &lt;internal registry IP&gt;:5000/&lt;namespace&gt;/image-policy-check:latest
    name: first</pre>
</div>
</div>
</li>
<li>
<p>Create a pod pointing to the internal registry using the imported image. The pod
should be created and if you look at the image specification, you should see the
tag unmodified.</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Pod
metadata:
  generateName: test-pod
spec:
  containers:
  - image: &lt;internal registry IP&gt;:5000/&lt;namespace&gt;/image-policy-check:v1
    name: first</pre>
</div>
</div>
</li>
<li>
<p>Get the digest from <code>oc get istag/image-policy-check:latest</code> and use it for
<code>oc annotate images/&lt;digest&gt; images.openshift.io/deny-execution=true</code>. For example:</p>
<div class="listingblock">
<div class="content">
<pre>$ oc annotate images/sha256:09ce3d8b5b63595ffca6636c7daefb1a615a7c0e3f8ea68e5db044a9340d6ba8 images.openshift.io/deny-execution=true</pre>
</div>
</div>
</li>
<li>
<p>Create this pod again, and you should see the pod rejected:</p>
<div class="listingblock">
<div class="content">
<pre>apiVersion: v1
kind: Pod
metadata:
  generateName: test-pod
spec:
  containers:
  - image: &lt;internal registry IP&gt;:5000/&lt;namespace&gt;/image-policy-check:latest
    name: first</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
    <footer class="footer-openshift">
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-sm-4 col-md-3">
      </div>
      <div class="col-xs-12 col-sm-4 col-md-6 text-center">
        <div class="row">
          <div class="col-xs-12 col-md-4">
          </div>
          <div class="col-xs-12 col-md-4">
          </div>
          <div class="col-xs-12 col-md-4">
          </div>
        </div>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-3 text-right">
        <a id="built_with_asciibinder" href="http://asciibinder.org/">
          <img src="http://docs.thedigitalgarage.io/_images/asciibinder_web_logo.svg" alt="AsciiBinder" />
        </a>
      </div>
    </div>
  </div>
</footer>
</body>
</html>